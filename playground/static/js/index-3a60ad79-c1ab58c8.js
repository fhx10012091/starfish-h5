import{d as O,R as U,U as W,a2 as G,$ as H,i as P,c as Y,r,a3 as Z,a4 as K,Y as L,z as E,a as i,b as m,j as _,l as Q,q as v,f as b,w as t,n as z,k as J,F as R,e as S,h as l,B as d,Z as X,G as x,H as ee,E as ae,a5 as le,a6 as te,a7 as ue,a8 as oe,a9 as ne,aa as se,ab as ie,N as re,M as de,v as ce}from"./main-837926ce.js";/* empty css                */import me from"./starfish-form-1fa50bcd-31b74c89.js";import{c as fe}from"./vue-codemirror.esm-21c23924.js";const pe=O({ControlType:"Rule",rule:U.getJsonValidate(),props:{...W},components:{Delete:G,Dynamicform:me,Codemirror:fe},setup(e){const{proxy:f}=H(),{formStore:w}=P("control")||{},V=Y(()=>w?.get("globalDatas")),A=r([]),B=r(Z),C=r({}),p=r({}),y=r({}),u=r({}),D=r(K.ruleJson),k=r(!0),h=r(),g=r(),F=r();return{IsShow:k,rules:A,ruleList:B,globalDatas:V,funcItem:C,funcValue:p,highItem:y,formValue:u,ruleJson:D,codeMyDialog:h,formRuleDialog:g,formdragger:F,handleDropdown(a){let o="";a=="enum"?o="自定义枚举":a=="func"?o="自定义函数规则":a=="high"&&(o="高级模式"),Array.isArray(e.data[e.item.data.fieldName])?e.data[e.item.data.fieldName].push({type:a,title:o,value:""}):(e.data[e.item.data.fieldName]=[],e.data[e.item.data.fieldName].push({type:a,title:o,value:""}))},handleFuncEdit(a){C.value=a,p.value=a.value?JSON.parse(JSON.stringify(a.value)):{trigger:"blur",func:`/** if (value === "" || value == null) {
*  callback(new Error("请输入"));
*} else if (!/^[0-9]*$/.test(value)) {
*  callback(new Error("必须为数字"));
*}
*callback(); 
*/`},h.value.init("函数编辑","icon-icon-bianji"),h.value.show()},saveFunc(){C.value.value=p.value,f.closeDialog()},closeDialog(){h.value.close(),g.value.close()},deleteRule(a){e.data[e.item.data.fieldName].splice(a,1)},async handleFormEdit(a){y.value=a,u.value=a.value||f.getDefaultData(D.value);debugger;g.value.init("规则表单编辑","icon-icon-bianji"),g.value.show()},getDefaultData(a){const o={};return a.forEach(n=>{o[n.data.fieldName]=n.data.default,n.data.getDefault&&(o[n.data.fieldName]=n.data.getDefault()),n.data.itemConfig&&(o[n.data.fieldName]=n.data.itemConfig.value),o[n.data.fieldName]=o[n.data.fieldName]!=null?JSON.parse(JSON.stringify(o[n.data.fieldName])):void 0}),o},saveField(){const a={},o={1:{fields:["required","trigger","message"]},2:{fields:["trigger","min","max","message"]},3:{fields:["required","trigger","type","message"]},4:{fields:["required","trigger","patternTemp","message"]},5:{fields:["trigger","minValue","maxValue","message"]}};for(const n in u.value)o[u.value.ruleType||"1"].fields.includes(n)&&(a[n]=u.value[n]);u.value.ruleType==2?(a.min=parseInt(a.min),a.max=parseInt(a.max)):u.value.ruleType==4?a.pattern=new RegExp(a.patternTemp):u.value.ruleType==5&&(a.validor=`(rule, value, callback) => {
            if (!/(^[1-9]*$)/.test(value)) {
              callback(new Error("请输入数字值"))
            } else {
              if (value > ${a.maxValue}) {
                callback(new Error("${a.message}"))
              } else if(value < ${a.minValue}){
                callback(new Error("${a.message}"))
              }else {
                callback()
              }
            }
          }`),a.ruleType=u.value.ruleType,y.value.value=a,g.value.close()}}}}),ge={key:0,class:"weight"},ve=_("span",{class:"tip iconfont icon-tishi"},null,-1),_e={key:0,class:"collapse_enums"},ye={key:1},he={key:2},Ce=_("i",{class:"el-icon-arrow-down el-icon--right"},null,-1),Fe={key:0,class:"sqlDialog",style:{padding:"20px",height:"100%"}},De=_("div",null,"(rule, value, callback, mainData) => {",-1),Ee=_("div",null,"}",-1);function be(e,f,w,V,A,B){const C=X,p=x,y=ee,u=ae,D=E("Delete"),k=le,h=te,g=ue,F=oe,a=ne,o=se,n=ie,j=E("codemirror"),N=re,$=E("CustomDialog"),q=E("Dynamicform"),T=de,M=ce;return i(),m("div",{class:z(["starfish-formitem starfish-formitem-rule",{formCover:e.drag,"starfish-vertical":e.labelalign!="top"}])},[_("div",{class:z(["label","label_"+e.labelalign]),style:J({width:e.labelWidth+"px"})},[_("label",null,Q(e.item.data.label),1),e.item.data.required?(i(),m("span",ge,"*")):v("",!0),e.item.data.tip?(i(),b(C,{key:1,class:"item",effect:"dark",content:e.item.data.tip,placement:"bottom-start"},{default:t(()=>[ve]),_:1},8,["content"])):v("",!0)],6),_("div",{class:"control",style:J({marginLeft:e.labelalign!="top"?e.labelWidth+"px":""})},[Array.isArray(e.data[e.item.data.fieldName])&&e.data[e.item.data.fieldName].length>0?(i(),b(g,{key:0},{default:t(()=>[(i(!0),m(R,null,S(e.data[e.item.data.fieldName],(s,I)=>(i(),b(h,{title:s.title,name:s.title,key:I},{default:t(()=>[s.type=="enum"?(i(),m("div",_e,[l(y,{modelValue:s.value,"onUpdate:modelValue":c=>s.value=c,placeholder:"请选择",style:{width:"100%"},size:"mini"},{default:t(()=>[(i(!0),m(R,null,S(e.ruleList,c=>(i(),b(p,{key:c.value,label:c.label,value:c.validator},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):v("",!0),s.type=="func"?(i(),m("div",ye,[l(u,{type:"primary",onClick:c=>e.handleFuncEdit(s),size:"mini"},{default:t(()=>[d("函数编辑")]),_:2},1032,["onClick"])])):v("",!0),s.type=="high"?(i(),m("div",he,[l(u,{type:"primary",onClick:c=>e.handleFormEdit(s),size:"mini"},{default:t(()=>[d("规则表单编辑")]),_:2},1032,["onClick"])])):v("",!0),l(u,{type:"danger",circle:"",onClick:c=>e.deleteRule(I),style:{"margin-left":"10px"}},{default:t(()=>[l(k,null,{default:t(()=>[l(D)]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["title","name"]))),128))]),_:1})):v("",!0),l(o,{onCommand:e.handleDropdown,style:{"margin-top":"10px"}},{dropdown:t(()=>[l(a,null,{default:t(()=>[l(F,{command:"enum"},{default:t(()=>[d("默认枚举")]),_:1}),l(F,{command:"func"},{default:t(()=>[d("自定义函数规则")]),_:1}),l(F,{command:"high"},{default:t(()=>[d("高级模式")]),_:1})]),_:1})]),default:t(()=>[l(u,{type:"success"},{default:t(()=>[d(" 新增规则"),Ce]),_:1})]),_:1},8,["onCommand"])],4),l($,{ref:"codeMyDialog"},{default:t(()=>[e.funcItem?(i(),m("div",Fe,[l(y,{modelValue:e.funcValue.trigger,"onUpdate:modelValue":f[0]||(f[0]=s=>e.funcValue.trigger=s),placeholder:"请选择",size:"mini",style:{"margin-bottom":"20px"}},{default:t(()=>[l(p,{label:"blur",value:"blur"}),l(p,{label:"change",value:"change"})]),_:1},8,["modelValue"]),l(n,{title:"rule是存放接收参数的对象;value是待校验的值;callback是回调函数(校验完后，要执行的操作，如抛错),mainData为表单数据",type:"success",style:{"margin-bottom":"15px"}}),De,l(j,{modelValue:e.funcValue.func,"onUpdate:modelValue":f[1]||(f[1]=s=>e.funcValue.func=s),ref:"cm",placeholder:"",mode:"text/javascript",style:{height:"320px"},autofocus:!0,"indent-with-tab":!0,"tab-size":2},null,8,["modelValue"]),Ee])):v("",!0),l(N,{class:"my-Footer",style:{height:"60px","text-align":"right"}},{default:t(()=>[l(u,{onClick:e.saveFunc,type:"primary"},{default:t(()=>[d("保存")]),_:1},8,["onClick"]),l(u,{onClick:e.closeDialog},{default:t(()=>[d("关闭")]),_:1},8,["onClick"])]),_:1})]),_:1},512),l($,{ref:"formRuleDialog"},{default:t(()=>[l(T,{style:{padding:"0"}},{default:t(()=>[l(M,{style:{height:"100%"}},{default:t(()=>[l(T,{class:"my-pageMain",style:{overflow:"hidden"}},{default:t(()=>[l(q,{ref:"formdragger",formResult:e.formValue,allFormList:e.ruleJson,globalConfig:Object.assign({},e.globalDatas,{size:"large"})},null,8,["formResult","allFormList","globalConfig"])]),_:1}),l(N,{class:"my-Footer",style:{height:"60px","text-align":"right"}},{default:t(()=>[l(u,{type:"primary",onClick:e.saveField},{default:t(()=>[d("保存")]),_:1},8,["onClick"]),l(u,{onClick:e.closeDialog},{default:t(()=>[d("关闭")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},512)],2)}const Be=L(pe,[["render",be]]);export{Be as default};
